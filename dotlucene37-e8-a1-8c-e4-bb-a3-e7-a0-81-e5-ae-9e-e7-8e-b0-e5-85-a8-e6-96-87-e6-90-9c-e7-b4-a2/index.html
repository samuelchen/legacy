<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>&gt;DotLucene:37行代码实现全文搜索 - Legacy - Explorer. Dream. Discover.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="DotLucene是一个强有力的开源全文搜索引擎，它是从Apache的Lucene（java）项目移植到.Net（C#）上的。   DotLucene的效率非常高，并且还具有对搜索结果评级、高光、搜索非结构数据以及本地化等特点。它还和Lucene的索引兼容，因此你可以在不同的平台间迁移而不会丢失任何索引数据。 本文介绍了如何通过简洁的代码来使用DotLucene完成全文搜索功能。 本文翻译自Co">
<meta name="keywords" content="Programming,Articles,Open Source">
<meta property="og:type" content="article">
<meta property="og:title" content="&gt;DotLucene:37行代码实现全文搜索">
<meta property="og:url" content="http://blog.samuelchen.net/legacy/dotlucene37-e8-a1-8c-e4-bb-a3-e7-a0-81-e5-ae-9e-e7-8e-b0-e5-85-a8-e6-96-87-e6-90-9c-e7-b4-a2/index.html">
<meta property="og:site_name" content="Legacy - Explorer. Dream. Discover.">
<meta property="og:description" content="DotLucene是一个强有力的开源全文搜索引擎，它是从Apache的Lucene（java）项目移植到.Net（C#）上的。   DotLucene的效率非常高，并且还具有对搜索结果评级、高光、搜索非结构数据以及本地化等特点。它还和Lucene的索引兼容，因此你可以在不同的平台间迁移而不会丢失任何索引数据。 本文介绍了如何通过简洁的代码来使用DotLucene完成全文搜索功能。 本文翻译自Co">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://www.codeproject.com/KB/aspnet/DotLuceneSearch/screenshot1.gif">
<meta property="og:updated_time" content="2019-04-12T05:56:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="&gt;DotLucene:37行代码实现全文搜索">
<meta name="twitter:description" content="DotLucene是一个强有力的开源全文搜索引擎，它是从Apache的Lucene（java）项目移植到.Net（C#）上的。   DotLucene的效率非常高，并且还具有对搜索结果评级、高光、搜索非结构数据以及本地化等特点。它还和Lucene的索引兼容，因此你可以在不同的平台间迁移而不会丢失任何索引数据。 本文介绍了如何通过简洁的代码来使用DotLucene完成全文搜索功能。 本文翻译自Co">
<meta name="twitter:image" content="http://www.codeproject.com/KB/aspnet/DotLuceneSearch/screenshot1.gif">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/legacy/legacy/webfonts/ptserif/main.css" rel="stylesheet" type="text/css">
  <link href="/legacy/legacy/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/legacy/css/style.css">
  

</head></html>
<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <a id="logo" class="logo logo-text" href="/legacy/">Legacy Posts - Explore. Dream. Discover.</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/legacy/">Home</a>
        
          <a class="main-nav-link" href="/legacy/archives">Archives</a>
        
          <a class="main-nav-link" href="/legacy/categories">Categories</a>
        
          <a class="main-nav-link" href="/legacy/tags">Tags</a>
        
          <a class="main-nav-link" href="/legacy/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.samuelchen.net/legacy"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-dotlucene37-e8-a1-8c-e4-bb-a3-e7-a0-81-e5-ae-9e-e7-8e-b0-e5-85-a8-e6-96-87-e6-90-9c-e7-b4-a2" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      &gt;DotLucene:37行代码实现全文搜索
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/legacy/dotlucene37-e8-a1-8c-e4-bb-a3-e7-a0-81-e5-ae-9e-e7-8e-b0-e5-85-a8-e6-96-87-e6-90-9c-e7-b4-a2/" class="article-date">
  <time datetime="2005-04-17T20:15:00.000Z" itemprop="datePublished">2005-04-18</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/legacy/categories/未分类/">未分类</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<p>DotLucene是一个强有力的开源全文搜索引擎，它是从Apache的Lucene（java）项目移植到.Net（C#）上的。 </p>
</blockquote>
<p>DotLucene的效率非常高，并且还具有对搜索结果评级、高光、搜索非结构数据以及本地化等特点。它还和Lucene的索引兼容，因此你可以在不同的平台间迁移而不会丢失任何索引数据。</p>
<p>本文介绍了如何通过简洁的代码来使用DotLucene完成全文搜索功能。</p>
<p>本文翻译自CodeProject上<!--StartFragment --> Dan Letecky 的 <a href="http://www.codeproject.com/aspnet/DotLuceneSearch.asp" target="_blank" rel="noopener">DotLucene: Full-Text Search for Your Intranet or Website using 37 Lines of Code</a> 一文，文章版权为原作者所有。</p>
<ul>
<li>译者：<a href="http://www.samuelchen.com/" target="_blank" rel="noopener">Samuel Chen</a> （初发于alphatom.com，该站已关闭）</li>
<li><a href="http://www.codeproject.com/useritems/DotLuceneSearch/DotLuceneSearch_src.zip" target="_blank" rel="noopener">本文源代码下载 - 363 Kb</a></li>
<li><a href="http://www.dotlucene.net/documentation/api/" target="_blank" rel="noopener">DotLucene在线演示</a></li>
<li><a href="http://www.dotlucene.net/download/" target="_blank" rel="noopener">Download下载包含预生成索引和HTML文档的源代码 [链接]</a></li>
</ul>
<p><img src="http://www.codeproject.com/KB/aspnet/DotLuceneSearch/screenshot1.gif" alt="Image" title="Image"></p>
<h5 id="DotLucene-优秀的全文搜索引擎"><a href="#DotLucene-优秀的全文搜索引擎" class="headerlink" title="DotLucene: 优秀的全文搜索引擎"></a>DotLucene: 优秀的全文搜索引擎</h5><p>有可能用37行代码写一个全文搜索么？ 恩，我正准备使点小技巧用DotLucene来完成这个麻烦的工作. <a href="http://www.dotlucene.net/" target="_blank" rel="noopener">DotLucene</a> 是一个Jakarta Lucene搜索引擎的移植项目，该项目由 <a href="http://sourceforge.net/projects/dotlucene/" target="_blank" rel="noopener">George Aroush et al</a> 维护。下面是它的一些特性： </p>
<ul>
<li>它能被用在 ASP.NET、WinForms 或者 console 应用；</li>
<li>非常高效的性能；<em>   搜索结果评级；</em>   搜索结果中查询关键字高光 ；</li>
<li>搜索结构化和非结构化数据；</li>
<li>Metadata 搜索 (时间查询、搜索指定域/字段…)*   索引大小大约是索引文本的30%；</li>
<li>并且能存储所有编入索引的文档 Can store also full indexed documents<em>   纯.Net托管代码，单个执行文件 (244 kB)</em>   非常友好的许可 (Apache Software License 2.0)*   本地化 (支持 巴西语、捷克语、中文、荷兰语、英语、法语、日语、韩语和俄语)</li>
<li>可扩展 (源代码已包含) </li>
</ul>
<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><pre><code>不要过于在意代码行数。我将用不超过37行代码给你演示他的核心功能，但是要做成一个真正实用的应用，你还需要花更多的时间... 
</code></pre><h5 id="演示项目"><a href="#演示项目" class="headerlink" title="演示项目"></a>演示项目</h5><p>这里，我们将做一个简单的项目演示怎么去做到如下几点：</p>
<ul>
<li>索引在指定目录（包括子目录）中找到的Html文件</li>
<li>用一个ASP.NET应用程序来搜索索引</li>
<li>搜索结果中高亮显示查询的单词 </li>
</ul>
<p>DotLucene还具有更多的潜力。在实际的应用中你大概想这么去做：</p>
<ul>
<li>当目录中怎就新文档时添加到索引，而不用重新编译整个索引*   包含各种文件类型。DotLuncene能够索引任何能转换成纯文本的文件类型 </li>
</ul>
<h5 id="为什么不使用微软索引服务（Microsoft-Indexing-Server）"><a href="#为什么不使用微软索引服务（Microsoft-Indexing-Server）" class="headerlink" title="为什么不使用微软索引服务（Microsoft Indexing Server）?"></a>为什么不使用微软索引服务（Microsoft Indexing Server）?</h5><p>如果你喜欢用索引服务，没问题。然而，使用DotLucene会有更多好处：</p>
<ul>
<li>DotLucene 是一个100%托管代码的单执行文件，不需要任何依赖<em>   它能被<a href="http://www.dotlucene.net/documentation/RunningDotLuceneonaShared.html" target="_blank" rel="noopener">使用到一个共享主机</a>。如果事先准备好索引，你可以不需要磁盘的写权限</em>   使用它，你可以从任何源（(数据库、网站…）索引任何类型数据（电子邮件、XML、HTML文件…）。那是因为你需要提供纯文本给索引器（Indexer），载入和解析取决于你<em>   允许你选择要包含在索引中的指定属性（”字段”），从而你可以使用这些字段来搜索（例如，作者、日期、关键字等）</em>   它是一个开源软件</li>
<li>它易于扩展 </li>
</ul>
<h5 id="第1行：建立索引"><a href="#第1行：建立索引" class="headerlink" title="第1行：建立索引"></a>第1行：建立索引</h5><p>下面的代码从存盘存储建立一个新的索引，directory是存储索引的目录路径参数。<br> <pre><span class="code">IndexWriter writer = new IndexWriter(directory, new StandardAnalyzer(), true);</span> </pre> </p>
<p>这个例子中我们总是重新创建索引（In this example we always create the index from scratch），但这不是必须的，你也可以打开一个已有的索引并添加文档进去。你还可以通过删除然后添加它们的新版本来更新现存的文档（译注：这里应该 是指对象的创建）</p>
<h5 id="第2-12行：添加文档"><a href="#第2-12行：添加文档" class="headerlink" title="第2 - 12行：添加文档"></a>第2 - 12行：添加文档</h5><p>我们为每一个HTML文档添加两个字段到索引： </p>
<ul>
<li>“text” 字段，容纳HTML文件的文本内容（去除了标记），文本数据本身并不会存储在索引中*   “path” 字段，容纳文件路径，它将会被（索引并）完整的存入索引中 <pre><span class="code">public void AddHtmlDocument(string path)<br>{<br>Document doc = new Document();</span></pre></li>
</ul>
<p>string rawText;<br>using (StreamReader sr = new StreamReader(path, System.Text.Encoding.Default))<br>{<br>   rawText = parseHtml(sr.ReadToEnd());<br>}</p>
<p>doc.Add(Field.UnStored(“text”, rawText));<br>doc.Add(Field.Keyword(“path”, path));<br>writer.AddDocument(doc);<br>}  </p>
<h5 id="第13-14行：优化并保存索引"><a href="#第13-14行：优化并保存索引" class="headerlink" title="第13 - 14行：优化并保存索引"></a>第13 - 14行：优化并保存索引</h5><p>添加完文档后，你需要关闭索引器。使用优化将会提高搜索性能。</p>
<p>writer.Optimize();<br>writer.Close();</p>
<h5 id="第15行：打开索引搜索"><a href="#第15行：打开索引搜索" class="headerlink" title="第15行：打开索引搜索"></a>第15行：打开索引搜索</h5><p>在做任何搜索之前，你需要打开索引。directory参数是存储索引的目录路径。<br> <pre><span class="code">IndexSearcher searcher = new IndexSearcher(directory);</span><br></pre> </p>
<h5 id="第16-27行：搜索"><a href="#第16-27行：搜索" class="headerlink" title="第16 - 27行：搜索"></a>第16 - 27行：搜索</h5><p>现在，我们解析查询了（”text”是默认搜索字段）<br> <pre>Query query = QueryParser.Parse(q, “text”, new StandardAnalyzer());<br>Hits hits = searcher.Search(query);<br></pre> </p>
<p>变量hits是搜索结果文档的集合，我们将通过它来将结果存储到DataTable<br> <pre><span class="code">DataTable dt = new DataTable();<br>dt.Columns.Add(“path”, typeof(string));<br>dt.Columns.Add(“sample”, typeof(string));</span></pre></p>
<p>for (int i = 0; i &lt; doc =” hits.Doc(i);” row =” dt.NewRow();”&gt;  </p>
<h5 id="第28-37行：高亮Lines-28-37-Query-Highlighting"><a href="#第28-37行：高亮Lines-28-37-Query-Highlighting" class="headerlink" title="第28 - 37行：高亮Lines 28 - 37: Query Highlighting"></a>第28 - 37行：高亮Lines 28 - 37: Query Highlighting</h5><p>我们先创建一个高亮器对象highlighter，并将使用加黑（bold）字体来高亮显示（<strong>查询词</strong>）。<br> <pre><span class="code">QueryHighlightExtractor highlighter = new<br>QueryHighlightExtractor(query, new StandardAnalyzer(), “<strong>“, “</strong>“);<br></span></pre> </p>
<p>通过对结果遍历，我们将载入原文中最相似的部分。<br> <pre><span class="code">for (int i = 0; i &lt; sr =” new” plaintext =” parseHtml(sr.ReadToEnd());”&gt; </span></pre> </p>
<h5 id="资源"><a href="#资源" class="headerlink" title="资源"></a>资源</h5><ul>
<li><a href="http://www.dotlucene.net/download/" target="_blank" rel="noopener">DotLucene download</a><em>   <a href="http://www.dotlucene.net/demo/" target="_blank" rel="noopener">Run DotLucene online demo</a></em>   <a href="http://www.dotlucene.net/demo/" target="_blank" rel="noopener">DotLucene online demo notes</a>*   <a href="http://www.dotlucene.net/documentation/" target="_blank" rel="noopener">DotLucene documentation</a></li>
</ul>

      
    </div>
  
    <footer class="article-footer">
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/legacy/tags/Articles/">Articles</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/legacy/tags/Open-Source/">Open Source</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/legacy/tags/Programming/">Programming</a></li></ul>

    </footer>
  
  </div>
  
    
<nav id="article-nav">
  
    <a href="/legacy/e4-bd-a0-e7-9a-84-e6-83-b3-e5-83-8f-e5-8a-9b-e6-99-ba-e5-95-86-e6-9c-89-e5-a4-9a-e9-ab-98/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          &gt;你的想像力智商有多高?
        
      </div>
    </a>
  
  
    <a href="/legacy/google-e7-9a-84-e7-a4-be-e4-bc-9a-e7-bd-91-e7-bb-9c/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">&gt;Google的社会网络&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Samuel Chen&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/legacy/legacy/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/legacy/fancybox/jquery.fancybox.css">
  <script src="/legacy/fancybox/jquery.fancybox.pack.js"></script>


<script src="/legacy/js/script.js"></script>
  </div>
</body>
</html>